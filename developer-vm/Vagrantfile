require "yaml"
settings = YAML.load_file "settings.yaml"

Vagrant.configure("2") do |config|

  config.ssh.insert_key = false

 config.vm.define "master" do |master|
    master.vm.box = settings["vm"]["box"]
    master.vm.hostname = settings["vm"]["hostname"]
    #network
    master.vm.network "private_network", ip: settings["vm"]["network"]["ip"]

   if settings["docker"]["install"] == true
    master.vm.provision "shell",
      env: {
        "VERSION" => settings["docker"]["version"],
      },
      path: "scripts/docker.sh"
   end

   if settings["kubernetes"]["install"] == true
    master.vm.provision "shell", reboot: true,
      env: {
        "KUBERNETES_VERSION" => settings["kubernetes"]["version"],
        "CRIO_OS" => settings["kubernetes"]["cri-o"]["os"],
        "CRIO_VERSION" => settings["kubernetes"]["cri-o"]["version"],
        "IP" => settings["vm"]["network"]["ip"]
      },
      path: "scripts/kubernetes.sh"
   end

  master.vm.provider "virtualbox" do |vb|
    vb.name = settings["vm"]["name"]
    vb.cpus = settings["vm"]["requirements"]["core"]
    vb.memory = settings["vm"]["requirements"]["memory"]
  end
 end


end
